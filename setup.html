<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>JayBeams: Configuration Guide: Howto Setup your Workstation to Compile JayBeams</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JayBeams
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Another project to have fun coding.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Configuration Guide: Howto Setup your Workstation to Compile JayBeams </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="setup_intro"></a>
Introduction</h1>
<p>These are my notes on how to prepare your environment to build JayBeams. If you find a problem with the instructions, please submit a patch for the instructions so I can fix the problem.</p>
<h1><a class="anchor" id="docker"></a>
Setting up a Docker based Development Environment</h1>
<p>Use any of the Dockerfiles found in the <code>docker/dev/*/Dockerfile</code> to create an image with all the necessary tools, we will use Ubuntu 14.04 as an example, but all of them would work in a similar fashion.</p>
<p>We are going to call this image <code>jbdevub14.04</code>, you may want to a shorter or longer name to suite your taste. We assume that <a href="https://docker.com">docker</a> is installed and configured in your workstation. We also assume the current user has enough privileges to run the docker command, otherwise all such commands need to be prefixed with <code>sudo</code>.</p>
<div class="fragment"><div class="line">git <a class="code" href="namespacejb_1_1yaml.html#a1be35fc9d86455bf9bdfc97bcae5144b">clone</a> https:<span class="comment">//github.com/coryan/jaybeams.git</span></div><div class="line">cd jaybeams</div><div class="line">docker build -t jbdevub14.04 docker/dev/ubuntu14.04</div></div><!-- fragment --><h2><a class="anchor" id="docker_build"></a>
Building a Docker Image for Development</h2>
<p>You could then run a shell within that image, download the Jaybeams source code and compile it, in this case:</p>
<div class="fragment"><div class="line">docker run --rm -it jbdevub14.04 /bin/bash</div></div><!-- fragment --><p>The following commands are executed inside the container, their output is discarded once you leave the shell.</p>
<div class="fragment"><div class="line">git <a class="code" href="namespacejb_1_1yaml.html#a1be35fc9d86455bf9bdfc97bcae5144b">clone</a> https:<span class="comment">//github.com/coryan/jaybeams.git</span></div><div class="line">cd jaybeams</div><div class="line">./bootstrap</div><div class="line">./configure --with-boost-libdir=/usr/lib/x86_64-linux-gnu</div><div class="line">make -j 4 check</div></div><!-- fragment --><h2><a class="anchor" id="docker_mount"></a>
Using the Working Directory in the Docker Container</h2>
<p>Sometimes it is convenient to use the jaybeams working directory inside the container, that allows you to test the same code with multiple distributions and compilers before you push the data. We provide a script that creates a docker image with a clone of your USER and UID inside the container, and mounts your current working copy as a volume.</p>
<p>To test it run:</p>
<div class="fragment"><div class="line">git <a class="code" href="namespacejb_1_1yaml.html#a1be35fc9d86455bf9bdfc97bcae5144b">clone</a> https:<span class="comment">//github.com/coryan/jaybeams.git</span></div><div class="line">cd jaybeams</div><div class="line">./docker/dev/runvariant.sh docker/dev/ubuntu14.04</div></div><!-- fragment --><p>That command will drop you into a shell inside the container for Ubuntu 14.04 with all the necessary development tools and dependencies pre-installed. You can then use it as normal, for example:</p>
<div class="fragment"><div class="line">./docker/dev/runvariant.sh docker/dev/ubuntu14.04</div></div><!-- fragment --><p>The following commands are executed inside the container, the <code>/home/$USER/jaybeams</code> directory is shared with the host, any changes are preserved after the shell exits.</p>
<div class="fragment"><div class="line">whoami</div><div class="line">ls -l</div><div class="line">./bootstrap</div></div><!-- fragment --><p>In this example we compile and test in a <code>build</code> subdirectory, you should onsider using a different build subdirectory for each container, e.g. <code>mkdir ${HOSTNAME?} &amp;&amp; cd ${HOSTNAME?}</code></p>
<div class="fragment"><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">../configure --with-boost-libdir=/usr/lib/x86_64-linux-gnu</div><div class="line">make -j 4 check</div></div><!-- fragment --><h2><a class="anchor" id="docker_test"></a>
Testing Docker Development Images</h2>
<p>From time to time you may need to modify or add a docker image, for example, to add new dependencies, or because a new version of a distribution or compiler has become available. Each directory has a helper Dockerfile that can be used to test if the image can be used for development. For example, let's suppose you have modified the Fedora 23 Dockerfile and want to test it, simply run:</p>
<div class="fragment"><div class="line">cat docker/dev/fedora23/Dockerfile{,.test} | docker build -</div></div><!-- fragment --><h2><a class="anchor" id="docker_as_docs"></a>
Using the Dockerfiles as Documentation</h2>
<p>If you prefer not to use docker, the scripts are fairly easy to read. Each <code>RUN</code> command is a step that you must follow manually.</p>
<h1><a class="anchor" id="fedora"></a>
Fedora 23</h1>
<p>We assume that you have superuser privileges in your workstation. The instructions were originally written for Fedora 23, I will try to make them more generic over time. Please submit patches to support other systems.</p>
<h2><a class="anchor" id="fedora_install_tools"></a>
Installing the Developement Tools</h2>
<div class="fragment"><div class="line">sudo dnf install -y autoconf </div><div class="line">    autoconf-archive </div><div class="line">    automake </div><div class="line">    boost </div><div class="line">    boost-devel </div><div class="line">    clang </div><div class="line">    clinfo </div><div class="line">    cmake </div><div class="line">    doxygen </div><div class="line">    fftw-devel </div><div class="line">    findutils </div><div class="line">    gcc-c++ </div><div class="line">    git </div><div class="line">    make </div><div class="line">    ocl-icd-devel </div><div class="line">    opencl-headers </div><div class="line">    patch </div><div class="line">    pocl-devel </div><div class="line">    tar </div><div class="line">    wget </div><div class="line">    yaml-cpp-devel</div></div><!-- fragment --><p>The <code>autoconf-archive</code> distributed with Fedora 23 triggers a bug in clang++ when determining if it supports C++11, to work around this problem you can patch the macros:</p>
<div class="fragment"><div class="line">cd /var/tmp</div><div class="line">git <a class="code" href="namespacejb_1_1yaml.html#a1be35fc9d86455bf9bdfc97bcae5144b">clone</a> --depth 2 https:<span class="comment">//github.com/coryan/jaybeams.git</span></div><div class="line">cd /var/tmp/jaybeams</div><div class="line">patch -d / -p0 &lt; m4/ax_cxx_compile_stdcxx.m4.patch</div></div><!-- fragment --><h2><a class="anchor" id="fedora_install_libraries"></a>
Installing Additional Libraries</h2>
<p><b>Skye (Small Mocking framework)</b></p>
<p>We are going to manually install a small mocking framework <a href="https://github.com/coryan/Skye">Skye</a></p>
<div class="fragment"><div class="line">wget -q https:<span class="comment">//github.com/coryan/Skye/releases/download/v0.3.2/skye-0.3.2.tar.gz</span></div><div class="line">tar -xf skye-0.3.2.tar.gz</div><div class="line">(cd skye-0.3.2 &amp;&amp; ./configure &amp;&amp; make check &amp;&amp; sudo make install)</div></div><!-- fragment --><p><b>clFFT (FFT library for OpenCL)</b></p>
<div class="fragment"><div class="line">wget -q https:<span class="comment">//github.com/clMathLibraries/clFFT/archive/v2.12.2.tar.gz</span></div><div class="line">tar -xf v2.12.2.tar.gz</div><div class="line">cd clFFT-2.12.2/src</div><div class="line">cmake -DCMAKE_INSTALL_PREFIX:PATH=/usr/local/clFFT-2.12.2 .</div><div class="line">make</div><div class="line">sudo make install</div><div class="line">cd ..</div><div class="line"></div><div class="line"></div><div class="line">echo /usr/local/clFFT-2.12.2/lib64 | sudo tee /etc/ld.so.conf.d/clfft-2.12.2.conf</div><div class="line">sudo ldconfig</div></div><!-- fragment --><p><b>Download and install Boost.Compute</b></p>
<div class="fragment"><div class="line">wget -q https:<span class="comment">//github.com/boostorg/compute/archive/boost-1.62.0.tar.gz</span></div><div class="line">tar -xf boost-1.62.0.tar.gz</div><div class="line">cd compute-boost-1.62.0</div><div class="line">cmake . &amp;&amp; make &amp;&amp; make DESTDIR=staging install</div><div class="line">sudo cp -r staging/usr/local/include/compute/boost/compute.hpp /usr/include/boost/</div><div class="line">sudo cp -r staging/usr/local/include/compute/boost/compute/ /usr/include/boost/</div></div><!-- fragment --><h2><a class="anchor" id="fedora_build"></a>
Checkout the Code and Build</h2>
<p>This is the easy part:</p>
<div class="fragment"><div class="line">git <a class="code" href="namespacejb_1_1yaml.html#a1be35fc9d86455bf9bdfc97bcae5144b">clone</a> https:<span class="comment">//github.com/coryan/jaybeams.git</span></div><div class="line">cd jaybeams</div><div class="line">./bootstrap</div><div class="line">./configure</div><div class="line">make</div></div><!-- fragment --><p>To compile and run the test use the <code>check</code> make target:</p>
<div class="fragment"><div class="line">make check</div></div><!-- fragment --><p>Optionally, consider building in a subdirectory, for example if you want to test with llvm:</p>
<div class="fragment"><div class="line">./bootstrap</div><div class="line">mkdir clang</div><div class="line">cd clang</div><div class="line">CXX=clang++ ../configure</div><div class="line">make -j 4 check</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
