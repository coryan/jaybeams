<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JayBeams: Configuration in JayBeams</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JayBeams
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Another project to have fun coding.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Configuration in JayBeams </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="jb_configuration_intro"></a>
Introduction</h1>
<p>Many classes in the JayBeams library have configuration parameters. The configuration parameters are designed to dynamically load the configuration at program startup time from either a configuration file or command-line arguments.</p>
<p>This document describes how a typical program would use the configuration facilities in JayBeams. If you prefer to use a different configuration system that is possible, and a relative simple exercise to the reader [<a class="el" href="jb_configuration.html#footnote">1</a>].</p>
<h1><a class="anchor" id="jb_configuration_goals"></a>
Goals</h1>
<p>We set ourselves the following goals for the configuration system:</p>
<ol type="1">
<li>It must be possible to read the configuration from a simple ASCII file.</li>
<li>Users and developers can override configuration parameters using command-line options.</li>
<li>Adding new attributes in the configuration file and command-line should not require writing the same code twice.</li>
<li>Classes can reuse the configuration parameters for their members, configuration is composable.</li>
<li>The file can be located in the usual places for the platform where the program is running, so administrators can set the configuration for all users.</li>
<li>The users can override the default location for configuration files.</li>
<li>Developers can use configuration files in the same location as the program to quickly test.</li>
<li>If both a configuration file and a command-line option is present, the command-line option takes precedence.</li>
</ol>
<p>We also have a number of secondary goals, such as:</p>
<ol type="1">
<li>Programs can override the default value for a configuration class.</li>
<li>The default values can be set at compile-time without modifying the code.</li>
</ol>
<h1><a class="anchor" id="jb_configuration_hierarchy"></a>
The jb::config_object Hierarchy</h1>
<p>In JayBeams, configuration parameters are defined as a hierarchy of <a class="el" href="classjb_1_1config__object.html" title="Base class for all configuration objects. ">jb::config_object</a> objects nested into each other. Each node in the hierarchy has a name, and optionally a class. Each leaf is a parameter that we want to configure. In a (<a class="el" href="namespaceYAML.html" title="Types and functions for the yaml-cpp library. ">YAML</a>)[<a href="http://www.yaml.org">http://www.yaml.org</a>) configuration the nodes are represented by, well, <a class="el" href="namespaceYAML.html" title="Types and functions for the yaml-cpp library. ">YAML</a> nodes. Each leaf also becomes a command-line argument, using the path of all the nodes to compose a the argument flag.</p>
<p>For example, suppose a JayBeams "Window" class has three configuration parameters, <code>name</code>, <code>height</code>, and <code>width</code>. And suppose a JayBeams program uses two windows, the <code>history</code> and <code>current</code> windows. A configuration file for such a program may read: </p><pre class="fragment">history:
  name: "Long Term Trends"
  width: 1000
  height: 200
current:
  name: "Recent Events"
  width: 1000
  height: 500
</pre><p>The user could override the height for the history window by passing the <code>--history.height=300</code> option in the command-line.</p>
<p>To create such a configuration the developer needs to create two classes, first a building block for the configuration of a single window:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>wcfg : <span class="keyword">public</span> <a class="code" href="classjb_1_1config__object.html">jb::config_object</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  wcfg()</div><div class="line">    : name(desc(<span class="stringliteral">&quot;name&quot;</span>).help(<span class="stringliteral">&quot;The name of the window&quot;</span>), this)</div><div class="line">    , width(desc(<span class="stringliteral">&quot;width&quot;</span>, <span class="stringliteral">&quot;window&quot;</span>), this)</div><div class="line">    , height(desc(<span class="stringliteral">&quot;height&quot;</span>, <span class="stringliteral">&quot;window&quot;</span>), this)</div><div class="line">  {}</div><div class="line"></div><div class="line">  <a class="code" href="config__object_8hpp.html#a0cc79b81f23b416c77f04fb0cb00cae0">config_object_constructors</a>(wcfg);</div><div class="line"></div><div class="line">  <a class="code" href="classjb_1_1config__attribute.html">jb::config_attribute&lt;wcfg, std::string&gt;</a> name;</div><div class="line">  <a class="code" href="classjb_1_1config__attribute.html">jb::config_attribute&lt;wcfg, int&gt;</a> width;</div><div class="line">  <a class="code" href="classjb_1_1config__attribute.html">jb::config_attribute&lt;wcfg, int&gt;</a> height;</div><div class="line">};</div></div><!-- fragment --><p>And compose that building block using another class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>pcfg : <span class="keyword">public</span> <a class="code" href="classjb_1_1config__object.html">jb::config_object</a></div><div class="line"><span class="keyword">public</span>:</div><div class="line">  pcfg()</div><div class="line">    : history(desc(&quot;history&quot;), this)</div><div class="line">    , current(desc(&quot;current&quot;), this)</div><div class="line">  {}</div><div class="line">  <a class="code" href="config__object_8hpp.html#a0cc79b81f23b416c77f04fb0cb00cae0">config_object_constructors</a>(pcfg);</div><div class="line"></div><div class="line">  <a class="code" href="classjb_1_1config__attribute.html">jb::config_attribute&lt;pcfg, wcfg&gt;</a> history;</div><div class="line">  <a class="code" href="classjb_1_1config__attribute.html">jb::config_attribute&lt;pcfg, wcfg&gt;</a> current;</div><div class="line">};</div></div><!-- fragment --><p>Then you can use that class as your main configuration point in your <code><a class="el" href="bm__clocks_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a></code> program:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="bm__clocks_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) <span class="keyword">try</span> {</div><div class="line">  pcfg config;</div><div class="line">  config.load_overrides(argc, argv, ...);</div><div class="line">}</div></div><!-- fragment --><p>That tells JayBeams to load the configuration parameters from the command-line. The command-line arguments are defined based on the hierarchy of objects, in this case the program would have a <code>--history.width</code> as well as a <code>--current.width</code> option.</p>
<p>In some programs it might be tedious to constantly type the same configuration parameters over and over. You can instruct JayBeams to load the configuration from a file:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="bm__clocks_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) <span class="keyword">try</span> {</div><div class="line">  pcfg config;</div><div class="line">  config.load_overrides(argc, argv, std::string(<span class="stringliteral">&quot;program.yaml&quot;</span>), ...);</div><div class="line">}</div></div><!-- fragment --><p>JayBeams will search for <code>program.yaml</code> in a number of predefined locations (on Linux, first on the <code>/etc/</code> directory, and then the same directory that has the binary for program). If found the configuration file is loaded first, and then any overrides from the command-line are parsed second.</p>
<p>If you want to provide an environment variable to control where the file is located you can also do so:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="bm__clocks_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) <span class="keyword">try</span> {</div><div class="line">  pcfg config;</div><div class="line">  config.load_overrides(argc, argv, std::string(<span class="stringliteral">&quot;program.yaml&quot;</span>), <span class="stringliteral">&quot;JB_ROOT&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><p>In this case, if JB_ROOT is defined, JayBeams first tries to load the file from the <code>${JB_ROOT}/etc</code> directory, before trying the standard locations.</p>
<h1><a class="anchor" id="jb_configuration_file"></a>
The YAML File Format</h1>
<p>If you are familiar with <a class="el" href="namespaceYAML.html" title="Types and functions for the yaml-cpp library. ">YAML</a> the configuration should be familiar to you. Each option is a key, and the hierarchy of <a class="el" href="namespaceYAML.html" title="Types and functions for the yaml-cpp library. ">YAML</a> Nodes matches the hierarchy of configuration objects. In the example we have been using that would be:</p>
<div class="fragment"><div class="line">current:</div><div class="line">  name: Current Events View</div><div class="line">  width: 500</div><div class="line">  height: 200</div><div class="line">history:</div><div class="line">  name: History of Events View</div><div class="line">  width: 500</div><div class="line">  height: 300</div></div><!-- fragment --><p>The only convention that might be unfamiliar is the definition of "classes". In some cases one may want to set all the instances of a certain parameter, regardless of its location in the hierarchy, for example let's say that we want all "windows" to be 500 units in width. Your configuration file could then say:</p>
<div class="fragment"><div class="line">:window:</div><div class="line">  width: 600</div><div class="line">current:</div><div class="line">  name: Current Events View</div><div class="line">  height: 200</div><div class="line">history:</div><div class="line">  name: History of Events View</div><div class="line">  height: 300</div></div><!-- fragment --><p>Per-instance overrides take precedence over class overrides. In other words, if you set the same parameter for a class and a particular instance the value set at the instance wins.</p>
<p><a class="anchor" id="footnote"></a>1. Load your configuration from whatever sources you use into the configuration parameters that the JayBeams classes you require. Or dynamically create a std::istream with the <a class="el" href="namespaceYAML.html" title="Types and functions for the yaml-cpp library. ">YAML</a> configuration you want. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
